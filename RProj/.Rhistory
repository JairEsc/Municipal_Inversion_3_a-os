library(sf)
municipios=read_sf("../../../Reutilizables/Cartografia/municipiosjair.shp")
demos=read.csv("../../../Reutilizables/Demograficos/iter_13_cpv2020/conjunto_de_datos/conjunto_de_datos_iter_13CSV20.csv")
demos=demos|>
dplyr::select(MUN,NOM_MUN,LOC,POBTOT) |>
dplyr::filter(MUN>0) |>
dplyr::filter(LOC==0)
View(demos)
demos=demos|>
dplyr::select(MUN,NOM_MUN,LOC,POBTOT) |>
dplyr::filter(MUN>0) |>
dplyr::filter(LOC==0)|>
dplyr::mutate(MUN=sprintf("%03d"))
demos=demos|>
dplyr::select(MUN,NOM_MUN,LOC,POBTOT) |>
dplyr::filter(MUN>0) |>
dplyr::filter(LOC==0)|>
dplyr::mutate(MUN=sprintf(MUN,"%03d"))
demos=demos|>
dplyr::select(MUN,NOM_MUN,LOC,POBTOT) |>
dplyr::filter(MUN>0) |>
dplyr::filter(LOC==0)|>
dplyr::mutate(MUN=sprintf("%03d",MUN))
View(demos)
municipios=municipios |>
dplyr::select(CVEGEO,NOM_MUN,CVE_MUN)
municipios=merge(municipios,demos,by.x='CVE_MUN',by.y='MUN')
View(municipios)
municipios=read_sf("../../../Reutilizables/Cartografia/municipiosjair.shp")
demos=read.csv("../../../Reutilizables/Demograficos/iter_13_cpv2020/conjunto_de_datos/conjunto_de_datos_iter_13CSV20.csv")
demos=demos|>
dplyr::select(MUN,NOM_MUN,LOC,POBTOT) |>
dplyr::filter(MUN>0) |>
dplyr::filter(LOC==0)|>
dplyr::mutate(MUN=sprintf("%03d",MUN)) |>
dplyr::select(-NOM_MUN)
municipios=municipios |>
dplyr::select(CVEGEO,NOM_MUN,CVE_MUN)
municipios=merge(municipios,demos,by.x='CVE_MUN',by.y='MUN',all.x=T)
municipios$inv_per_cap_dir=rnorm(84,mean = 150000,sd=5000)
municipios$inv_per_cap_indir=rnorm(84,mean = 1500,sd=50)
View(municipios)
st_write(municipios,"geojson_hgo.geojson",driver = "geojson")
z=read.csv("../Datos/SIPDUS_Municipios_2022-2025.csv")
View(z)
gsub("//.",replacement = ";",z$Obra)
gsub("//.",replacement = ";",z$Obra)[1]
gsub("//.",replacement = ";",z$Obra)[1:5]
gsub("//,",replacement = ";",z$Obra)[1:5]
gsub("\\,",replacement = ";",z$Obra)[1:5]
z$Obra=gsub("\\,",replacement = ";",z$Obra)[1:5]
z$Obra=gsub("\\,",replacement = ";",z$Obra)
z=read.csv("../Datos/SIPDUS_Municipios_2022-2025.csv")
z$Obra=gsub("\\,",replacement = ";",z$Obra)
z |> dplyr::select(Rubro,Ejercicio,NOM_MUN,Inversión,Habitantes.beneficiados,Obra) |>
write.csv("../Datos/SIPDUS_2022-2025.csv")
View(municipios)
z$NOM_MUN[z$NOM_MUN=='Cobertura Estatal']
sipdus_300625=sf::read_sf("SIPDUS_BDGeneral2.shp")
rows=sipdus_300625 |> sf::st_drop_geometry() |> dplyr::group_by(No.) |> dplyr::slice_head(n=1) |> dplyr::select(No.) |> unique()
varios_mun = sipdus_300625[grepl(pattern = ",", x = sipdus_300625$Municipio ),]
unique_mun = sipdus_300625[!grepl(pattern = ",", x = sipdus_300625$Municipio ),]
municipios=municipios |> st_transform(st_crs(sipdus_300625))
library(sf)
sipdus_300625=sf::read_sf("SIPDUS_BDGeneral2.shp")
rows=sipdus_300625 |> sf::st_drop_geometry() |> dplyr::group_by(No.) |> dplyr::slice_head(n=1) |> dplyr::select(No.) |> unique()
varios_mun = sipdus_300625[grepl(pattern = ",", x = sipdus_300625$Municipio ),]
unique_mun = sipdus_300625[!grepl(pattern = ",", x = sipdus_300625$Municipio ),]
municipios=municipios |> st_transform(st_crs(sipdus_300625))
varios_mun = sipdus_300625[grepl(pattern = ",", x = sipdus_300625$Municipio ),]
unique_mun = sipdus_300625[!grepl(pattern = ",", x = sipdus_300625$Municipio ),]
municipios=municipios |> st_transform(st_crs(sipdus_300625))
guardar = NULL
for (i in 1:nrow(varios_mun)) {
#i=15
interes = varios_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
plot(mun_interes$geometry)
fila = varios_mun[i,]
plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
municipio_correcto = mun_interes$NOM_MUN[which(0==min(inter))]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar = dplyr::bind_rows(guardar, fila)
}
sipdus_300625=sf::read_sf("SIPDUS_BDGeneral2.shp")
rows=sipdus_300625 |> sf::st_drop_geometry() |> dplyr::group_by(No.) |> dplyr::slice_head(n=1) |> dplyr::select(No.) |> unique()
varios_mun = sipdus_300625[grepl(pattern = ",", x = sipdus_300625$Municipio ),]
unique_mun = sipdus_300625[!grepl(pattern = ",", x = sipdus_300625$Municipio ),]
municipios=municipios |> st_transform(st_crs(sipdus_300625))
guardar = NULL
for (i in 1:nrow(varios_mun)) {
#i=15
interes = varios_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
plot(mun_interes$geometry)
fila = varios_mun[i,]
plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
municipio_correcto = mun_interes$NOM_MUN[which(0==as.numeric(min(inter)))]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar = dplyr::bind_rows(guardar, fila)
}
guardar = NULL
for (i in 1:nrow(varios_mun)) {
#i=15
interes = varios_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
plot(mun_interes$geometry)
fila = varios_mun[i,]
plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
municipio_correcto = mun_interes$NOM_MUN[which(inter==min(inter) & min(inter)<5000)]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar = dplyr::bind_rows(guardar, fila)
}
guardar = NULL
for (i in 1:nrow(varios_mun)) {
#i=15
interes = varios_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
plot(mun_interes$geometry)
fila = varios_mun[i,]
plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
municipio_correcto = mun_interes$NOM_MUN[which(inter==min(inter) & as.numeric(min(inter))<5000)]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar = dplyr::bind_rows(guardar, fila)
}
View(guardar)
guardar = NULL
for (i in 1:nrow(varios_mun)) {
#i=15
interes = varios_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
plot(mun_interes$geometry)
fila = varios_mun[i,]
plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
if(as.numeric(min(inter))<5000){
municipio_correcto = mun_interes$NOM_MUN[which(inter==min(inter) )]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar = dplyr::bind_rows(guardar, fila)
}
else{
print("Más lejos de 5 km")
}
}
View(guardar)
guardar2=NULL
for (i in 1:nrow(unique_mun)) {
#i=15
interes = unique_mun$Municipio[i]
interes_vector = strsplit(interes, ",") |>  unlist()
mun_interes = municipios[which(municipios$NOM_MUN %in% interes_vector),]
#plot(mun_interes$geometry)
fila = unique_mun[i,]
#plot(fila$geometry, add = T, col = "red")
inter =sf::st_distance(fila,mun_interes)
## sf::st_intersects(x = mun_interes, y = fila)##Distancia
if(as.numeric(min(inter))<5000){
municipio_correcto = mun_interes$NOM_MUN[which(inter==min(inter) )]
cat("Vamos en", i, "donde el municipio correcto es",municipio_correcto, "\n" )
print(min(inter))
fila = fila |>  dplyr::mutate(Municipio_inters = municipio_correcto)
guardar2 = dplyr::bind_rows(guardar2, fila)
}
else{
print("Más lejos de 5 km")
}
}
View(guardar2)
sipdus_unique_muns=rbind(guardar,guardar2)
sipdus_unique_muns=sipdus_unique_muns |>
dplyr::group_by(No.,Municipio) |>
dplyr::slice_head(n=1)
View(sipdus_unique_muns)
View(sipdus_unique_muns)
View(sipdus_unique_muns)
obras_p_mun=readxl::read_excel("../RProj/SIPDUS_Municipios_2022-2025.xlsx")
View(obras_p_mun)
identical(obras_p_mun$Municipio_ind,obras_p_mun$Municipio)
obras_p_mun_cgeom=merge(
obras_p_mun,
sipdus_unique_muns,
by.x=c("No.","Municicpio_ind"),
by.y=c("No.","Municicpio"),
all.x=T
)
obras_p_mun_cgeom=merge(
x=obras_p_mun,
y=sipdus_unique_muns,
by.x=c("No.","Municicpio_ind"),
by.y=c("No.","Municicpio"),
all.x=T
)
obras_p_mun_cgeom=merge(
x=obras_p_mun,
y=sipdus_unique_muns,
by.x=c("No.","Municicpio_ind"),
by.y=c("No.","Municicpio"),
all.x=T
)
obras_p_mun_cgeom=merge(
x=obras_p_mun |>
dplyr::mutate(join=paste0(No.,"-",Municipio_ind)),
y=sipdus_unique_muns|>
dplyr::mutate(join=paste0(No.,"-",Municipio)),
by='join',
all.x=T
)
View(obras_p_mun_cgeom)
obras_p_mun_cgeom=obras_p_mun_cgeom |> sf::st_as_sf() |>
dplyr::filter(!sf::st_is_empty(geometry))
View(obras_p_mun_cgeom)
library(sf)
obras_p_mun_cgeom |> dplyr::select(join,Obra.x,Municipio_inters,geometry) |>
st_transform(st_crs("EPSG:4326")) |>
st_write("../Datos/spidus_geojson_by_id_mun_poquitos.geojson",driver = "GeoJSON")
##Obras por mun ya en bonito
obras_ya_util=read.table("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "\t")
##Obras por mun ya en bonito
obras_ya_util=read.csv("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "\t")
View(obras_ya_util)
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "\t")
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "t")
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "\r\t")
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",sep = "\t")
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv")
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",header = T,sep='\t')
View(obras_ya_util)
View(obras_p_mun_cgeom)
obras_ya_util=obras_ya_util |>
dplyr::filter(ID%in%obras_p_mun_cgeom$No..x)
View(obras_ya_util)
View(obras_ya_util)
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",header = T,sep='\t')
View(obras_ya_util)
obras_p_mun_cgeom$No..x
obras_ya_util$ID |> unique()
obras_p_mun_cgeom$No..x |> unique()
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",header = T,sep='\t')
obras_ya_util=obras_ya_util |>
dplyr::filter(as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
View(obras_ya_util)
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",header = T,sep='\t')
obras_ya_util$ID |> unique() |> length()
obras_p_mun_cgeom$No..x |> unique() |> length()
View(obras_p_mun_cgeom)
obras_ya_util_no=obras_ya_util |>
dplyr::filter(!as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
obras_ya_util_si=obras_ya_util |>
dplyr::filter(as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
View(obras_ya_util_no)
View(obras_p_mun_cgeom)
View(sipdus_300625)
##Obras por mun ya en bonito
obras_ya_util=read.delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",header = T,sep='\t')
library(readr)
##Obras por mun ya en bonito
obras_ya_util=readr::read_tsv("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv")
##Obras por mun ya en bonito
obras_ya_util=readr::read_tsv("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",sep='\t')
##Obras por mun ya en bonito
obras_ya_util=readr::read_delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",sep='\t')
##Obras por mun ya en bonito
obras_ya_util=readr::read_delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",delim = "\t")
##Obras por mun ya en bonito
obras_ya_util=readr::read_delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",delim = "\\\t")
##Obras por mun ya en bonito
obras_ya_util=readr::read_delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",delim = "\\t")
View(obras_ya_util)
##Obras por mun ya en bonito
obras_ya_util=readr::read_delim("../Datos/SIPDUS_2022-2025_tiene_geo (3).tsv",delim = "\t")
##Obras por mun ya en bonito
obras_ya_util=readxl::read_excel("../Datos/SIPDUS_2022-2025_tiene_geo.xlsx")
View(obras_ya_util)
obras_ya_util_no=obras_ya_util |>
dplyr::filter(!as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
obras_ya_util_si=obras_ya_util |>
dplyr::filter(as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
View(obras_ya_util_si)
1170+404
View(sipdus_unique_muns)
obras_p_mun_cgeom=merge(
x=obras_p_mun |>
dplyr::mutate(join=paste0(No.,"-",Municipio_ind)),
y=sipdus_unique_muns|>
dplyr::mutate(join=paste0(No.,"-",Municipio)),
by='join',
all.x=T
)
View(obras_p_mun_cgeom)
View(obras_p_mun)
obras_p_mun_cgeom=merge(
x=obras_p_mun |>
dplyr::mutate(join=paste0(No.,"-",Municipio)),
y=sipdus_unique_muns|>
dplyr::mutate(join=paste0(No.,"-",Municipio)),
by='join',
all.x=T
)
View(obras_p_mun_cgeom)
obras_p_mun_cgeom=obras_p_mun_cgeom |> sf::st_as_sf() |>
dplyr::filter(!sf::st_is_empty(geometry))
View(obras_p_mun_cgeom)
obras_p_mun_cgeom |> dplyr::select(join,Obra.x,Municipio_inters,geometry) |>
st_transform(st_crs("EPSG:4326")) |>
st_write("../Datos/spidus_geojson_by_id_mun_poquitos.geojson",driver = "GeoJSON")
##Obras por mun ya en bonito
obras_ya_util=readxl::read_excel("../Datos/SIPDUS_2022-2025_tiene_geo.xlsx")
obras_ya_util_si=obras_ya_util |>
dplyr::filter(as.numeric(ID)%in%obras_p_mun_cgeom$No..x)
View(obras_ya_util_si)
obras_ya_util=obras_ya_util |>
dplyr::mutate(tiene_geo=ifelse(ID%in%obras_ya_util_si$ID))
obras_ya_util=obras_ya_util |>
dplyr::mutate(tiene_geo=ifelse(ID%in%obras_ya_util_si$ID,1,0))
View(obras_ya_util)
obras_ya_util=obras_ya_util |>
dplyr::mutate(tiene_geo=ifelse(ID%in%obras_ya_util_si$ID,TRUE,FALSE))
View(obras_ya_util)
obras_ya_util |> write.table("../Datos/SIPDUS_2022-2025_tiene_geo (2).tsv",row.names = F,sep = "\t")
obras_p_mun_cgeom |> dplyr::select(join,Obra.x,Municipio_inters,geometry) |>
st_transform(st_crs("EPSG:4326")) |>
st_write("../Datos/spidus_geojson_by_id_mun_poquitos.geojson",driver = "GeoJSON")
View(sipdus_300625)
unique(sipdus_300625$geometry) |> length()
View(obras_p_mun_cgeom)
unique(obras_p_mun_cgeom$geometry) |> length()
View(obras_p_mun_cgeom)
obras_p_mun_cgeom |> dplyr::select(join,Obra.x,Municipio_inters,Localidad.x,Trabajos.x,Inversión,Ejercicio.x,Ejercicio.x,geometry) |>
st_transform(st_crs("EPSG:4326")) |>
st_write("../Datos/spidus_geojson_by_id_mun_poquitos.geojson",driver = "GeoJSON")
obras_p_mun_cgeom |> dplyr::select(join,Obra.x,Municipio_inters,Localidad.x,Trabajos.x,Inversión,Ejercicio.x,Ejercicio.x,geometry) |>
st_transform(st_crs("EPSG:4326")) |>
st_write("spidus_geojson_by_id_mun_poquitos.geojson",driver = "GeoJSON")
zzz=read.csv("../../../Georeferenciacion_SIPDUS.csv")
zzz2=zzz |>
dplyr::group_by(No.) |>
dplyr::summarise(municipios_original=paste0(NOM_MUN,collapse = ","))
View(zzz2)
zzz3=mrege(zzz,zzz2,by='No.',all.x=T)
zzz3=merge(zzz,zzz2,by='No.',all.x=T)
View(zzz3)
zzz4=zzz3 |> dplyr::group_by(No.,municipios_original) |>
dplyr::slice_head(n=1)
View(zzz4)
View(zzz4)
zzz4 |> write.csv("sipdus_para_separar_localidades.csv",row.names = F)
View(zzz4)
zzz4$No. |> unique() |> length()
zzz5=zzz4[grepl(",",x = zzz4$Localidad),]
View(zzz5)
zzz5=zzz4[grepl(",",x = zzz4$Localidad)&grepl(",",x = zzz4$municipios_original),]
View(zzz5)
